"function add_files_dialog(){"
	"hide_all_except(['dirselect-container','tagselect-files-container','add-files-dialog']);"
"}"

"function add_file(){"
	"const queue = document.getElementById('add-files-queue');"
	"const urls = [];"
	"queue.textContent.replace(/(?:^|\\n)([0-9]+)[\\s]+([^\\n]+)/, function(group0, group1, group2){"
		"urls.push([group1, group2]);"
	"});"
	"if(urls.length===0){"
		"alert(\"No file URLs\");"
		"return;"
	"}"
	"const tagselect = $('#tagselect-files');"
	"const tag_ids = tagselect.val();"
	"if(tag_ids.length === 0){"
		// TODO: Replace with confirmation dialog
		"alert(\"No tags\");"
		"return;"
	"}"
	"for(const [_dir_id, url] of urls){"
		"const _dir_name = d[parseInt(_dir_id)][0];"
		"if(!url.startsWith(_dir_name)){"
			"alert(\"URL is assigned an incorrect directory: \" + url);"
			"return;"
		"}"
	"}"
	"$.ajax({"
		"type:\"POST\","
		"url:\"http://localhost:1999/add-f/\" + tag_ids.join(\",\") + \"/\"," // Trailing slash is for server's convenience
		"data:queue.textContent,"
		"success:function(){"
			"tagselect.val(\"\").change();"
			"queue.innerHTML = \"\";" // Remove URLs
			"alert(\"Success\");"
		"},"
		"dataType:\"text\""
	"});"
"}"

"function add_files__append(){"
	"const inp = document.getElementById('add-file-input');"
	"const _dir_id = document.getElementById(\"dirselect\").value;"
	"const x = inp.value;"
	"if(x === \"\"){"
		"alert(\"Enter a file URL\");"
		"return;"
	"}"
	"if(!x.startsWith(d[_dir_id][0])){"
		"alert(\"Directory must be a prefix of the file URL\");"
		"return;"
	"}"
	"document.getElementById('add-files-queue').innerText += \"\\n\" + _dir_id + \"\\t\" + inp.value;"
	"inp.value = \"\";"
"}"
