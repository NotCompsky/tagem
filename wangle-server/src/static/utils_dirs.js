"function set_dir_name_from_id(dir_id, node_id){"
	"set_var_to_json_then('d', '/a/d.json', function(){"
		"dir_name = d[dir_id][0];"
		"device_id = d[dir_id][1];"
		"document.getElementById(node_id).innerText = dir_name;"
	"});"
"}"
"function display_child_dirs(dir_id){"
	"set_var_to_json_then('d', '/a/d.json', function(){"
		"dir_name = d[dir_id][0];"
		"const arr = Object.entries(d).filter(([k,v]) => (k != dir_id) && (v[0].startsWith(dir_name))).map(([k,v]) => \"<a onclick='view_dir(\" + k + \")'>\" + v[0] + \"</a>\");"
		"document.getElementById('children').innerHTML = arr.join(\"<br/>\");"
	"});"
"}"
"function display_parent_dirs(dir_id){"
	"set_var_to_json_then('d', '/a/d.json', function(){"
		"dir_name = d[dir_id][0];"
		"const dir_name2id = Object.keys(d).reduce(function(obj, key){"
			"obj[d[key][0]] = key;"
			"return obj;"
		"}, {});"
		"var pth = \"\";"
		"const arr = dir_name.split(\"/\").map(x => pth+=x+\"/\").map(x => dir_name2id[x])"
			".filter(x => x)" // Removes undefined elements
			".map(x => \"<a onclick='view_dir(\" + x + \")'>\" + d[x][0] + \"</a>\")"
		";"
		"arr.pop();" // Remove last element, which is the current directory
		"document.getElementById('parents').innerHTML = arr.join(\"<br/>\");"
	"});"
"}"

"function populate_d_id2name_table(selector, arr){"
	"set_var_to_json_then('d', '/a/d.json', function(){"
		"var s = \"\";"
		"for (const [id, ls] of Object.entries(d)){"
			"if ((arr !== undefined)  &&  (!arr.includes(id)))"
				"continue;"
			"s +="
				"\""
					"<div class='tr'>"
					"<div class='td'>"
					"<a onclick='view_dir("
				"\" + id + \")'>\" + ls[0] + \"</a></div><div class='td'><a onclick='view_device(\" + ls[1] + \")'>Device</a></div></div>\""
			";"
		"}"
		"document.querySelector(selector).innerHTML = s;"
	"});"
"}"


"function view_dir(_dir_id){"
	"hide('tags-container');"
	"unhide('parents-container');"
	"unhide('children-container');"
	"hide('before-files-tbl');"
	"unhide('f');"
	"hide('d');"
	"hide('t');"
	"unhide('tagselect-files-container');"
	"hide('tagselect-self-p-container');"
	"hide('tagselect-self-c-container');"
	
	"file_tagger_fn = after_tagged_selected_files;"

	"if (_dir_id !== undefined){"
		"dir_id = _dir_id;"
		"$.ajax({"
			"dataType: \"json\","
			"url: \"/a/d/i/\"+dir_id,"
			"success: function(data){"
				"var s = \"\";"
				"$('#dir_name').text(data[0]);"
			"},"
			"error: function(){"
				"alert(\"Error populating table\");"
			"}"
		"});"
		"populate_f_table('/a/f/d/' + dir_id);"
	"}"
	
	"set_dir_name_from_id(dir_id, 'profile-name');"
	
	"display_parent_dirs(dir_id);"
	"display_child_dirs(dir_id);"
	
	"window.location.hash = 'd' + dir_id;"
"}"
"function view_dirs(ls){"
	"hide('tags-container');"
	"hide('parents-container');"
	"hide('children-container');"
	"hide('before-files-tbl');"
	"hide('f');"
	"unhide('d');"
	"hide('t');"
	"hide('tagselect-files-container');"
	"hide('tagselect-self-p-container');"
	"hide('tagselect-self-c-container');"
	"populate_d_id2name_table('#d .tbody', ls);"
	"document.getElementById(\"profile-name\").textContent = \"All Directories\";"
	"window.location.hash = '';"
"}"
