#include <boost/preprocessor.hpp>
#include "../js.hpp"


#define ADD_TOGGLE(id, name) \
	"<div id=\"" id "-container\" class=\"toggle-container\">" \
		"<b class=\"toggle-name\">" name "</b>" \
		"<input id=\"" id "\" type=\"checkbox\" class=\"toggle-input\"/>" \
	"</div>"

"<!DOCTYPE html>"
"<html lang=\"en\">"
"<head>"
	"<meta charset=\"utf-8\"/>"
	#include "components/jquery.html"
	#include "components/select2.html"
	
	"<link rel=\"stylesheet\" type=\"text/css\" href=\"/s/tbl1.css\">"
	"<link rel=\"stylesheet\" type=\"text/css\" href=\"/s/tbl2.css\">"
	"<link rel=\"stylesheet\" href=\"/s/a.css\"/>"
"</head>"
"<script src=\"https://rawgit.com/ccampbell/mousetrap/master/mousetrap.js\"></script>"
"<script type=\"text/javascript\">" 
	MINIMISED_JS_ALL
	
	"window.addEventListener('popstate',  e => " MINIMISED_JS_DECL_load_page_from_a_hash_string "(e.state));"
	// Although we could store the page's data, thereby reducing requests to the server, it wouldn't be easy to check whether the data is out of date or not.
	
	"$(document).ready("
		MINIMISED_JS_DECL_on_document_ready
	");"
"</script>"

"<body>"

R"=========(
<!--
Copyright (c) 2020 by Aysenur Turk (https://codepen.io/TurkAysenur/pen/RwWKYMO)

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-->
<div id="content">
  <div id="left-side">
    <div class="logo">TAGEM</div>
    <div class="side-wrapper">
      <div class="side-title">SITEMAP</div>
      <div class="side-menu">
)========="
#define CREATE_SITEMAP_LINK(r, data, elem) \
	"<a onclick=\"" BOOST_PP_TUPLE_ELEM(0, elem) "\">" BOOST_PP_TUPLE_ELEM(1, elem) "</a><br/>"
BOOST_PP_SEQ_FOR_EACH(CREATE_SITEMAP_LINK, _, BOOST_PP_VARIADIC_SEQ_TO_SEQ((MINIMISED_JS_DECL_view_dirs"()","All Dirs")(MINIMISED_JS_DECL_view_tags"()","All Tags")(MINIMISED_JS_DECL_view_tasks"()","All Tasks")(MINIMISED_JS_DECL_view_dir"(prompt('/directory/path/'),1)","Filesystem Dir")(MINIMISED_JS_DECL_unhide"('help')","Help")(MINIMISED_JS_DECL_rotate_stylesheet"()",">Table Style")(MINIMISED_JS_DECL_view_text_editor"()","Text Editor")(MINIMISED_JS_DECL_add_tags_dialog"()","+Tags")(MINIMISED_JS_DECL_add_files_dialog"()","+Files")(MINIMISED_JS_DECL_add_dirs_dialog"()","+Dirs")(MINIMISED_JS_DECL_add_devices_dialog"()","+Devices")))
R"=========(
      </div>
    </div>
    <div class="side-wrapper">
      <div class="side-title">RECENT</div>
      <div id="recent-pages" class="side-menu">
      </div>
    </div>
    <a href="https://twitter.com/AysnrTrkk" class="follow-me" target="_blank">
      <span class="follow-text">
        <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
        CSS/HTML largely based on work by...
     </span>
      <span class="developer">
        <img src="https://pbs.twimg.com/profile_images/1253782473953157124/x56UURmt_400x400.jpg" />
        Aysenur Turk — @AysnrTrkk
      </span>
    </a>
  </div>
  <div class="main">
    <div class="search-bar">
      <input id="qry" type="text" placeholder="Search"/>
    </div>
    <div id="main-container">
      <div class="profile">
        <div class="profile-avatar">
          <img id="profile-img" src="/favicon.ico"/>
          <div id="profile-name"></div>
        </div>
        <img id="profile-cover"/>
)========="
#define CREATE_MENU_ITEM(r, data, elem) \
	"<a onclick=\"" BOOST_PP_TUPLE_ELEM(0, elem) "()\">" BOOST_PP_TUPLE_ELEM(1, elem) "</a>"

		"<div id=\"profile-menu\">"
BOOST_PP_SEQ_FOR_EACH(CREATE_MENU_ITEM, _, BOOST_PP_VARIADIC_SEQ_TO_SEQ((MINIMISED_JS_DECL_toggle"('left-side')","&#9666;")(MINIMISED_JS_DECL_view_dir,"Dir")(MINIMISED_JS_DECL_view_tag,"Tag")(MINIMISED_JS_DECL_view_tags,"Tags")(MINIMISED_JS_DECL_view_file,"File")(MINIMISED_JS_DECL_view_files,"Files")(MINIMISED_JS_DECL_toggle"('right-side')","&#9656;")))
		"</div>"
	"</div>"


"<div id=\"qry-help\" class=\"hidden help\">"
	"<h2>How to Query</h2>"
	"<button onclick=\"" MINIMISED_JS_DECL_hide "('qry-help')\">Hide</button>"
	"<p>"
		#include "../qry-help-text.txt"
	"</p>"
"</div>"

"<div id=\"tasks-container\">"
	"<h1>Tasks</h1>"
	"<div id=\"tasks\"></div>"
"</div>"

#include "components/help.html"

"<div id=\"tagging\">"

"<div id=\"file-info\">"
	"<div id=\"view\">"
		"<video id=\"view-video\" controls>"
			"<source>Browser does not support videos</source>"
		"</video>"
		"<audio id=\"view-audio\" controls>"
			"<source>Browser does not support audio</source>"
		"</audio>"
		"<img id=\"view-img\"/>"
		"<iframe id=\"view-iframe\" frameborder=\"0\" scrolling=\"no\" allow=\"autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen>Browser does not support iframes</iframe>"
		"<object id=\"view-object\">Browser does not support object elements</object>"
		"<div id=\"view-yt-player\">"
			"<div id=\"yt-player\"></div>"
			// This div is *replaced* by the Youtube IFrame API, so causes issues when told to hide while it is loading
		"</div>"
	"</div>"
	
	"<a id=\"dir_name\" onclick=\"" MINIMISED_JS_DECL_view_this_files_dir "()\"></a>" "<a id=\"file_name\"></a>"
	"<br/>"
	"<button id=\"add-era\" onclick=\"" MINIMISED_JS_DECL_set_era_vertex "()\">+Era</button>"
	ADD_TOGGLE("autoplay","Autoplay")
	"<button id=\"next-f-in-playlist\" onclick=\"" MINIMISED_JS_DECL_playlist_listener "()\">Next</button>"
	"<button onclick=\"" MINIMISED_JS_DECL_toggle_file_add_backup_dialog "()\">+Backups</button>"
	
	"<div id=\"view-btns-container\">"
		"<b>View</b>"
		"<div id=\"view-btns\">"
			"<a id=\"view-btn-main\" class=\"view-btn\" onclick=\"" MINIMISED_JS_DECL_display_this_file "()\">"
				"Original"
			"</a>"
			"<div id=\"view-btns-backups\"></div>"
		"</div>"
	"</div>"
	
	"<button onclick=\"" MINIMISED_JS_DECL_show_update_orig_src_dialog "()\">Update src</button>"
	
	"<div id=\"posts-container\">"
		"<div id=\"db-links\"></div>"
		"<div id=\"post-container\">"
			"<a id=\"post-user\" class=\"user\"></a>"
			"<time id=\"post-time\"></time>"
			"<div id=\"post-text\"></div>"
			
			"<br/>"
			"<a onclick=\"" MINIMISED_JS_DECL_view_likes "()\">Likes</a>"
			"<div id=\"likes\">"
				"<a onclick=\"" MINIMISED_JS_DECL_hide "('likes')\">Hide</a>"
				"<div id=\"likes-ls\"></div>"
			"</div>"
			"<br/>"
			
			"<div id=\"cmnts-container\">"
				"<br/>"
				"<a onclick=\"" MINIMISED_JS_DECL_toggle "('cmnts')\">Show/Hide Comments</a>"
				"<div id=\"cmnts\"></div>"
			"</div>"
		"</div>"
	"</div>"
"</div>"

"<div id=\"file2-container\">"
	"<button onclick=\"" MINIMISED_JS_DECL_toggle "('file2')\">+Value</button>"
	"<div id=\"file2\">"
		"<h3>Assign Value</h3>"
		"<select id=\"file2-select\"></select>"
		"<input id=\"file2-value\" type=\"text\" pattern=\"\\d*\" placeholder=\"12345\"/>"
		"<button onclick=\"" MINIMISED_JS_DECL_assign_value_to_file "()\">Update DB</button>"
	"</div>"
"</div>"

// elem = (id,text,fn)
#define CREATE_TAG_SELECT(r, data, elem) \
	"<div id=\"" BOOST_PP_TUPLE_ELEM(0, elem) "-container\" class=\"tagselect-container\">" \
		"<button id=\"" BOOST_PP_TUPLE_ELEM(0, elem) "-btn\" onclick=\"" BOOST_PP_TUPLE_ELEM(2, elem) "\">" BOOST_PP_TUPLE_ELEM(1, elem) "</button>" \
		"<select class=\"tagselect\" id=\"" BOOST_PP_TUPLE_ELEM(0, elem) "\" multiple=\"multiple\"></select>" \
	"</div>"
#define TAG_FN1 \
	MINIMISED_JS_DECL_add_parent_tags_then"("MINIMISED_JS_DECL_tag_id",'#tagselect-self-p', function(){" \
		MINIMISED_JS_DECL_display_parent_tags"("MINIMISED_JS_DECL_tag_id",'#parents');" \
	"})"
#define TAG_FN2 \
	MINIMISED_JS_DECL_add_child_tags_then"("MINIMISED_JS_DECL_tag_id",'#tagselect-self-c', function(){" \
		MINIMISED_JS_DECL_display_child_tags"("MINIMISED_JS_DECL_tag_id",'#children');" \
	"})"
BOOST_PP_SEQ_FOR_EACH(CREATE_TAG_SELECT, _, BOOST_PP_VARIADIC_SEQ_TO_SEQ(("tagselect-self-p","Add Parent Tags",TAG_FN1)("tagselect-self-c","Add Child Tags",TAG_FN2)))

"<div id=\"user-info\">"
	"<h3 id=\"user-fullname\"></h3>"
	
	"<img id=\"verified\" src=\"https://freeiconshop.com/wp-content/uploads/edd/checkmark-flat.png\"/>"
	
	"<a id=\"n-followers\"></a>"
	"<a id=\"n-following\"></a>"
	
	"<a onclick=\"" MINIMISED_JS_DECL_display_posts "(" MINIMISED_JS_DECL_db_id "," MINIMISED_JS_DECL_user_id ",'u')\">Authored Posts</a>"
	"<a onclick=\"" MINIMISED_JS_DECL_display_posts "(" MINIMISED_JS_DECL_db_id "," MINIMISED_JS_DECL_user_id ",'l')\">Liked Posts</a>"
	"<a onclick=\"" MINIMISED_JS_DECL_display_posts "(" MINIMISED_JS_DECL_db_id "," MINIMISED_JS_DECL_user_id ",'c')\">Commented Posts</a>"
"</div>"

#define CREATE_SELECT(r, data, elem) \
	"<div id=\"" elem "select-container\">" \
		"<select id=\"" elem "select\"></select>" \
	"</div>"
BOOST_PP_SEQ_FOR_EACH(CREATE_SELECT, _, ("dir")("device")("protocol"))

#include "components/change-file-to-backup.html"

#define CREATE__ADD_TO_DB__DIALOG(r, data, elem) \
	"<div id=\"add-" BOOST_PP_TUPLE_ELEM(0, elem) "-dialog\">" \
		"<input id=\"add-" BOOST_PP_TUPLE_ELEM(0, elem) "-input\" type=\"text\" placeholder=\"" BOOST_PP_TUPLE_ELEM(1, elem) "\"/>" \
		"<button class=\"inline\" onclick=\"" MINIMISED_JS_DECL_add_to_db__append "('" BOOST_PP_TUPLE_ELEM(0, elem) "')\">+</button>" \
		"<div id=\"add-" BOOST_PP_TUPLE_ELEM(0, elem) "-queue\" contenteditable=\"true\"></div>" \
		"<button onclick=\"" MINIMISED_JS_DECL_add_to_db "('" BOOST_PP_TUPLE_ELEM(0, elem) "')\">Add to database</button>" \
	"</div>"
BOOST_PP_SEQ_FOR_EACH(CREATE__ADD_TO_DB__DIALOG, _, BOOST_PP_VARIADIC_SEQ_TO_SEQ(("t","New Tag Name")("f","File URL, e.g. https://www.youtube.com/watch?v=dQw4w9WgXcQ")("d","'Directory' URL, i.e. a prefix of file URLS, e.g. https://www.youtube.com/watch?v=")("D","'Device' URL, e.g. https://youtube.com/")))

"<div id=\"add-f-backup\" class=\"hidden\">"
	"<input id=\"add-f-backup-url\" placeholder=\"Use this URL instead...\"/>"
	ADD_TOGGLE("add-f-backup-ytdl","YouTube-DL?")
	"<a onclick=\"" MINIMISED_JS_DECL_backup_files "()\">Send backup request</a>"
"</div>"

BOOST_PP_SEQ_FOR_EACH(CREATE_TAG_SELECT, _, BOOST_PP_VARIADIC_SEQ_TO_SEQ(("tagselect-files","Add Tags to Files", MINIMISED_JS_DECL_tag_files_then "(" MINIMISED_JS_DECL_get_file_ids "(), '#tagselect-files'," MINIMISED_JS_DECL_file_tagger_fn ")")))
#undef FILE_TAGGER_FN
#undef FILE_TAGGER_FILE_IDS

"</div>"

"<div id=\"text-editor\">"
	"<h2 contenteditable=\"true\">Edit file name here...</h2>"
	"<button onclick=\"" MINIMISED_JS_DECL_text_editor_save "()\">Save</button>"
	"<div id=\"text-edit\" contenteditable=\"true\">"
		"Write text here..."
	"</div>"
"</div>"

#define COL_NAMES ("Thumb")("Name")
#define COL_FILTERS (0,"")(1,"regexp")
#define TBL_ID "t"
#define TBL_NAME_COLS "[1]"
#define TBL_TAGS_COLS "[]"
#include "components/tbl.html"

#define COL_NAMES ("Name")("Device")
#define COL_FILTERS (1,"regexp")(1,"regexp")
#define TBL_ID "d"
#define TBL_NAME_COLS "[0,1]"
#define TBL_TAGS_COLS "[]"
#include "components/tbl.html"

#define ACTION_BTNS ("",MINIMISED_JS_DECL_prompt_thumb_w"()","Thumb Size")("select-all",MINIMISED_JS_DECL_select_rows "('#f .tbody .tr:not(.hidden)')","Select All")("deselect-all",MINIMISED_JS_DECL_deselect_rows "('#f .tbody .tr', 1);"MINIMISED_JS_DECL_deselect_rows"('#f .tbody .tr', 2);"MINIMISED_JS_DECL_deselect_rows"('#f .tbody .tr', 3);","Deselect All")("merge-files",MINIMISED_JS_DECL_merge_files"()","Merge Files")("backup-files",MINIMISED_JS_DECL_toggle_file_add_backup_dialog"()","Backup")("add-file2",MINIMISED_JS_DECL_toggle"('file2-container')","Add/Update Value")("view-as-playlist",MINIMISED_JS_DECL_view_files_as_playlist"()","View as Playlist")
#define IS_SELECTABLE
#define COL_NAMES ("Thumb")("Name")("In Databases")("Tags")("Size (Range)")
#define COL_FILTERS (0,"")(1,"regexp")(1,"regexp")(1,"regexp")(1,"12.3KB - 45.6MB")
#define TBL_ID "f"
#define TBL_NAME_COLS "[1]"
#define TBL_TAGS_COLS "[3]"
#include "components/tbl.html"

R"=========(
    </div>
  </div>
  <div id="right-side">
    <div class="account">
      <span class="account-user"><p id="username"></p>
        <img src="https://upload.wikimedia.org/wikipedia/commons/9/93/Google_Contacts_icon.svg" class="account-profile" alt="">
)========="
		"<button onclick=\"if(" MINIMISED_JS_DECL_get_cookie "('username')===undefined)" MINIMISED_JS_DECL_login "();else " MINIMISED_JS_DECL_logout "()\">▼</button>"
R"=========(
      </span>
    </div>
)========="
#define CREATE_SIDE_WRAPPER(r, data, elem) \
	"<div id=\"" elem "-container\" class=\"side-wrapper\">" \
		"<div class=\"side-title\">" elem "</div>" \
		"<div id=\"" elem "\"></div>" \
	"</div>"
BOOST_PP_SEQ_FOR_EACH(CREATE_SIDE_WRAPPER, _, ("values")("parents")("children")("tags"))
R"=========(
  </div>
</div>
)========="

"</body>"
"</html>"
